CC=gcc
CFLAGS=-fPIC -g -O0 -Wall -I/usr/local/include
LDFLAGS=-L/usr/local/lib -o
LIBS=-lm
TESTLIBS=-lcheck $(LIBS)
BENCHLIBS=-lcobra $(LIBS)

## Output programs
SONAME=libipecac.so
LIBRARY=build/libipecac.a
LIBRARYSO=build/$(SONAME)
TESTBIN=build/run_test
BENCHBIN=build/run_bench
ALL_PROGRAMS=$(LIBRARY) $(LIBRARYSO) $(TESTBIN) $(BENCHBIN)

## Output .o files
LIBRARY_OBS=\
src/arithmetic.o\
src/bitwise.o\
src/convert.o\
src/function.o\
src/internal.o\
src/misc.o\
src/util.o

TESTBIN_OBS=\
test/check_arithmetic.o\
test/check_bitwise.o\
test/check_convert.o\
test/check_function.o\
test/check_main.o

BENCHBIN_OBS=\
benchmark/bench_arithmetic.o\
benchmark/bench_main.o

all: $(ALL_PROGRAMS)

$(LIBRARY): $(LIBRARY_OBS)
	ar rcs $@ $^

$(LIBRARYSO): $(LIBRARY_OBS)
	$(CC) -shared -Wl,-soname,$(SONAME) -o $@ $^ $(LIBS)

$(TESTBIN): $(LIBRARY_OBS) $(TESTBIN_OBS)
	$(CC) $(CFLAGS) -Lbuild $(LDFLAGS) $@ $^ $(TESTLIBS)

$(BENCHBIN): $(LIBRARY_OBS) $(BENCHBIN_OBS)
	$(CC) $(CFLAGS) -Lbuild $(LDFLAGS) $@ $^ $(BENCHLIBS)

clean:
	rm -f $(LIBRARY_OBS) $(TESTBIN_OBS) $(BENCHBIN_OBS) $(ALL_PROGRAMS)

